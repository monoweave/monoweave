<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.15.0-prebuilt-libvips.6+6294a74bfb"/><meta data-react-helmet="true" name="description" content="The all-in-one monorepo publishing framework."/><meta data-react-helmet="true" property="og:title" content="Architecture"/><meta data-react-helmet="true" property="og:description" content="The all-in-one monorepo publishing framework."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Top Hat"/><meta data-react-helmet="true" name="twitter:title" content="Architecture"/><meta data-react-helmet="true" name="twitter:description" content="The all-in-one monorepo publishing framework."/><meta name="theme-color" content="#55879B"/><style data-href="https://monoweave.github.io/monoweave/styles.bc031f18f6b2901af375.css" data-identity="gatsby-global-css">@import url(https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap);*,:after,:before{background-repeat:no-repeat}:after,:before{text-decoration:inherit;vertical-align:inherit}:where(:root){-webkit-tap-highlight-color:transparent;-webkit-text-size-adjust:100%;cursor:default;line-height:1.5;overflow-wrap:break-word;tab-size:4}:where(body){margin:0}:where(h1){font-size:2em;margin:.67em 0}:where(dl,ol,ul) :where(dl,ol,ul){margin:0}:where(hr){color:inherit;height:0}:where(nav) :where(ol,ul){list-style-type:none;padding:0}:where(nav li):before{content:"\200B";float:left}:where(pre){font-family:monospace,monospace;font-size:1em;overflow:auto}:where(abbr[title]){text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}:where(b,strong){font-weight:bolder}:where(code,kbd,samp){font-family:monospace,monospace;font-size:1em}:where(small){font-size:80%}:where(audio,canvas,iframe,img,svg,video){vertical-align:middle}:where(iframe){border-style:none}:where(svg:not([fill])){fill:currentColor}:where(table){border-collapse:collapse;border-color:inherit;text-indent:0}:where(button,input,select){margin:0}:where(button,[type=button i],[type=reset i],[type=submit i]){-webkit-appearance:button}:where(fieldset){border:1px solid #a0a0a0}:where(progress){vertical-align:baseline}:where(textarea){margin:0;resize:vertical}:where([type=search i]){-webkit-appearance:textfield;outline-offset:-2px}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}:where(dialog){background-color:#fff;border:solid;color:#000;height:fit-content;left:0;margin:auto;padding:1em;position:absolute;right:0;width:fit-content}:where(dialog:not([open])){display:none}:where(details>summary:first-of-type){display:list-item}:where([aria-busy=true i]){cursor:progress}:where([aria-controls]){cursor:pointer}:where([aria-disabled=true i],[disabled]){cursor:not-allowed}:where([aria-hidden=false i][hidden]){display:initial}:where([aria-hidden=false i][hidden]:not(:focus)){clip:rect(0,0,0,0);position:absolute}*,:after,:before{box-sizing:border-box}html{--primary-font-family:"Source Sans Pro",sans-serif;--primary-background-colour:#0079a9;--primary-foreground-colour:#fff;--secondary-background-colour:#8bb2c8;--accent-background-colour:#1e1e1e;--alt-accent-background-colour:#383838}body,html{font-family:var(--primary-font-family)}header.main{background:var(--primary-background-colour);margin-bottom:1.45rem}span.strikethrough{text-decoration:line-through}a.anchor.before{margin-right:.2em}table.typedoc-schema{background:var(--primary-background-colour);color:var(--primary-foreground-colour);font-size:1.05em;max-width:100%;overflow-x:auto;padding:20px;text-align:left}table.typedoc-schema th{font-size:1.4em;padding:.4em 1em .4em .6em;white-space:nowrap}table.typedoc-schema tbody .name{color:inherit;text-decoration:none}table.typedoc-schema tbody .name:hover{text-decoration:underline}table.typedoc-schema tbody .name.deprecated{color:inherit;text-decoration:line-through}table.typedoc-schema tbody .type{font-family:monospace;font-size:.9em}table.typedoc-schema tbody tr{background:var(--accent-background-colour)}table.typedoc-schema tbody tr:nth-child(odd){background:var(--alt-accent-background-colour)}table.typedoc-schema tbody tr.schema-option.deprecated{background:repeating-linear-gradient(45deg,var(--accent-background-colour),var(--alt-accent-background-colour) 10px,var(--accent-background-colour) 10px,var(--alt-accent-background-colour) 20px)}table.typedoc-schema tbody .description a{color:inherit}table.typedoc-schema tbody .description p{margin:.2em 0 .6em}table.typedoc-schema td{line-height:1.5;padding:.4em 1em}table.typedoc-schema td:first-child{white-space:nowrap}@media (max-width:700px){table.typedoc-schema tr{display:flex;flex-direction:column}table.typedoc-schema tbody .description{margin-top:.1em;padding-top:.2em}}nav.header-nav{background:var(--secondary-background-colour);display:block;width:100%}nav.header-nav a{color:var(--primary-foreground-colour);font-weight:700;text-decoration:none}nav.header-nav a:hover{transform:scale(1.1)}nav.header-nav a.active,nav.header-nav a:hover{text-decoration:underline}nav.header-nav ul{align-items:center;display:flex;flex-wrap:wrap;justify-content:center;margin:0 auto;max-width:1000px;padding:0}nav.header-nav li{flex-grow:1;padding:.75em 1.5em;text-align:center;white-space:nowrap}pre.inline-code{background:#1e1e1e;color:#9cdcfe;display:inline;font-family:monospace;padding:.25em}pre.inline-code,pre.prism-code{border-radius:4px}main li{margin-bottom:1em}main blockquote{background:#f9f9f9;border-left:10px solid var(--secondary-background-colour);margin:0;padding:.5em 10px;quotes:"\201C" "\201D" "\2018" "\2019"}main blockquote p{display:inline}main delete{text-decoration:line-through}table.plain{font-size:1.05em;margin-bottom:1em;max-width:960px;overflow-x:auto;overflow-y:auto;padding:20px;text-align:left}table.plain th{padding:.4em 1em .4em 0;white-space:nowrap}table.plain td,table.plain th{border:1px solid #f9f9f9;padding-left:.2em}div.scroll{overflow:auto}</style><title data-react-helmet="true">Architecture | Monoweave</title><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="icon" href="https://monoweave.github.io/monoweave/favicon-32x32.png?v=b4ec658cfef64c34c7a9136191cdd46a" type="image/png"/><link rel="manifest" href="/monoweave/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="https://monoweave.github.io/monoweave/icons/icon-48x48.png?v=b4ec658cfef64c34c7a9136191cdd46a"/><link rel="apple-touch-icon" sizes="72x72" href="https://monoweave.github.io/monoweave/icons/icon-72x72.png?v=b4ec658cfef64c34c7a9136191cdd46a"/><link rel="apple-touch-icon" sizes="96x96" href="https://monoweave.github.io/monoweave/icons/icon-96x96.png?v=b4ec658cfef64c34c7a9136191cdd46a"/><link rel="apple-touch-icon" sizes="144x144" href="https://monoweave.github.io/monoweave/icons/icon-144x144.png?v=b4ec658cfef64c34c7a9136191cdd46a"/><link rel="apple-touch-icon" sizes="192x192" href="https://monoweave.github.io/monoweave/icons/icon-192x192.png?v=b4ec658cfef64c34c7a9136191cdd46a"/><link rel="apple-touch-icon" sizes="256x256" href="https://monoweave.github.io/monoweave/icons/icon-256x256.png?v=b4ec658cfef64c34c7a9136191cdd46a"/><link rel="apple-touch-icon" sizes="384x384" href="https://monoweave.github.io/monoweave/icons/icon-384x384.png?v=b4ec658cfef64c34c7a9136191cdd46a"/><link rel="apple-touch-icon" sizes="512x512" href="https://monoweave.github.io/monoweave/icons/icon-512x512.png?v=b4ec658cfef64c34c7a9136191cdd46a"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><header class="main"><div style="margin:0 auto;max-width:960px;padding:1.45rem 1.0875rem"><h1 style="margin:0"><a style="color:white;text-decoration:none" href="/monoweave/">Monoweave</a></h1><a href="https://github.com/monoweave/monoweave" style="color:#ffffff" rel="noreferrer">View GitHub Project</a></div><nav class="header-nav"><ul><li><a href="/monoweave/">Home</a></li><li><a href="/monoweave/getting-started/">Getting Started</a></li><li><a href="/monoweave/configuration/">Configuration</a></li><li><a href="/monoweave/plugins/">Plugins</a></li><li><a aria-current="page" class="active" href="/monoweave/architecture/">Architecture</a></li><li><a href="/monoweave/faq/">FAQ</a></li><li><a href="/monoweave/contributing/">Contributing</a></li></ul></nav></header><div style="margin:0 auto;max-width:960px;padding:0 1.0875rem 1.45rem"><main><h2 id="architecture" style="position:relative"><a href="#architecture" aria-label="architecture permalink" class="anchor before"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Architecture</h2>
<h3 id="code-organization" style="position:relative"><a href="#code-organization" aria-label="code organization permalink" class="anchor before"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Code Organization</h3>
<p>The Monoweave codebase is a Yarn-monorepo built using Monoweave.</p>
<p>The <pre class="inline-code">packages/cli</pre> directory contains the root <pre class="inline-code">@monoweave/cli</pre> package, which provides a CLI around the programmatic API that is housed in <pre class="inline-code">@monoweave/node</pre>.</p>
<h3 id="pipeline" style="position:relative"><a href="#pipeline" aria-label="pipeline permalink" class="anchor before"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Pipeline</h3>
<span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 17.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+klEQVR42hXN63KCMBRGUd//1bTeUMZASCBXQkIRgbGdDucr/t+z9u4qJ3ZRv/QQ3ha3E7LzgRpZQRsHXpbUKIdTNbrzQ68Xnuav3ETetPBVRobfYI1BNBWClpBpxY65Nyv9D0kdbLAN+s7R8zli0DlSc6eXY7jrxel2WLmd5lyE2DqDjh+oE2dExeBljk4VMGHcQD2xQiVSG+e2Sx89TdOE5BW8EpSCxcO+nQkf8DWLdokxfWOwjAZXIbkavRNbX0N/wH35ZHvxphv3VgqOuq7JWou77HHMFV3liANf3LkI65EP81EsMTN/yHhLVx6Qcw8pJEoukTUL/gE/iSIFPkxaywAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Architecture Diagram"
        title=""
        src="https://monoweave.github.io/monoweave/static/fc24deaf2d736de2b45d8ca8d33bda42/00d43/architecture.png"
        srcset="https://monoweave.github.io/monoweave/static/fc24deaf2d736de2b45d8ca8d33bda42/63868/architecture.png 250w,
https://monoweave.github.io/monoweave/static/fc24deaf2d736de2b45d8ca8d33bda42/0b533/architecture.png 500w,
https://monoweave.github.io/monoweave/static/fc24deaf2d736de2b45d8ca8d33bda42/00d43/architecture.png 1000w,
https://monoweave.github.io/monoweave/static/fc24deaf2d736de2b45d8ca8d33bda42/aa440/architecture.png 1500w,
https://monoweave.github.io/monoweave/static/fc24deaf2d736de2b45d8ca8d33bda42/60fbd/architecture.png 1991w"
        sizes="(max-width: 1000px) 100vw, 1000px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></span>
<p>When monoweave is run outside of dry run mode (the default in CI), it executes a number of &quot;pipeline&quot; stages in sequence.</p>
<ol>
<li>Project Initialization: The project is &quot;parsed&quot; using the Yarn Modern APIs. A Yarn-incompatible project will fail at this stage. All configuration is fully resolved and plugins instantiated.</li>
<li>Gathering Project State: In this stage we need to determine the &quot;current state&quot; of all workspaces. This ultimately depends on the <pre class="inline-code">RegistryMode</pre> in the monoweave configuration. Note that RegistryMode is evaluated per workspace, so it&#x27;s possible to have some workspaces pull version information from NPM while others pull from the manifest.
a. Default / NPM: The latest and/or pre-release tags are fetched for all workspaces from the appropriate NPM registry.
b. Manifest: The latest tag is read from the workspace&#x27;s package.json file.</li>
<li>Resolving Explicit Version Strategies: In this stage monoweave needs to determine what types of changes to apply to each workspace, starting with &quot;explicit&quot; changes. Version strategy determination (whether a workspace should receive a &quot;patch/minor/major&quot; bump, a &quot;prerelease&quot; bump, or none at all) depends on whether monoweave is running in &quot;automatic&quot; (default/recommended) or &quot;manual&quot; mode. The determination of the version strategies by package is the beginning of the creation of Monoweave&#x27;s &quot;changeset&quot;. This changeset is enhanced a few times throughout the pipeline before ultimately being written out to the changeset file.
a. Manual: Committed version files are consumed. In manual mode, commit messages are completely ignored.
b. Automatic: If a conventional changelog configuration is provided, it will be used directly for version determination, otherwise a reasonable default is built-in to monoweave. Commit messages are parsed for information that will determine what type of strategy to apply to each workspace.</li>
<li>Resolving Implicit Version Strategies: Once monoweave has a set of workspaces with associated version strategies, it needs to determine implicit strategies. This is accomplished by traversing the dependencies graph and finding all dependents of the explicitly bumped packages, excluding dependents which themselves are explicitly bumped. These dependent packages are automatically given a patch version strategy. This is to ensure downstream consumers of the explicitly bumped packages receive updates. If using package groups (similar to Lerna&#x27;s fixed mode), the greatest strategy is assumed for each group. Note that if no groups are specified, monoweave defaults to treat each package as its own independent group.</li>
<li>Resolving Versions From Strategies: The collection of version strategies associated with the individual workspaces are now read to apply the version strategy (e.g. &quot;minor&quot;) to the latest version of each package. Each package group resolves to use the largest version number among the group for each of its members.</li>
<li>Update package.json Files: Package manifests (<pre class="inline-code">package.json</pre> files) are updated so the <pre class="inline-code">version</pre> of the manifest, and the versions listed in the <pre class="inline-code">dependencies</pre>, <pre class="inline-code">peerDependencies</pre>, and <pre class="inline-code">devDependencies</pre> fields reflect the latest versions we are about to publish. If <pre class="inline-code">persistVersions</pre> is set to false, the changes to the package.json files will be reverted post-publish. Once the package.json files are updated, Yarn will trigger an install to update the Yarn lockfiles as well as any other install state files.</li>
<li>Writing Changelogs: The changeset data assembled in the earlier pipeline stages is formatted and piped through to the loaded conventional changelog config if in automatic mode, or through a built-in changelog writer if using manual mode.</li>
<li>Publishing &amp; Lifecycle Script Execution: Depending on configuration options, the changelog files, and the modified package manifests are committed. Once a publish commit has been created, each workspace is published to the appropriate registry according to the workspace&#x27;s configuration. It&#x27;s possible to have a project where some workspaces publish to a private registry, some to a public one, and some that aren&#x27;t published at all (e.g. manifest registry mode). Before and after publishing each package, the appropriate npm lifecycle hooks are executed. These hooks are guaranteed to be executed in topological order, if the topological configuration option is enabled. Post-NPM publish, if all is successful, the git commit and tags are pushed to the remote git registry.</li>
</ol>
<p>At various steps throughout the pipepline, Monoweave plugin hooks will be triggered. Note that most of Monoweave&#x27;s behaviour can be modified either through simple configuration or plugins.</p>
<h3 id="lifecycle-scripts" style="position:relative"><a href="#lifecycle-scripts" aria-label="lifecycle scripts permalink" class="anchor before"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Lifecycle Scripts</h3>
<p>At various points in the publish lifecycle, Monoweave will execute special lifecycle scripts. If leveraging lifecycle scripts, you&#x27;ll want to familiarize yourself with this section, since Monoweave may act differently than NPM, Yarn, or Lerna.</p>
<p>There are two types of lifecycle scripts, &quot;pre&quot; scripts and &quot;post&quot; scripts. Monoweave will execute <em>all</em> &quot;pre&quot; scripts prior to actually publishing any packages, even if using topological sort. This enables you to leverage the pre lifecycle hooks to abort the publish early without leaving the repository in a half-published state.</p>
<p>Once all pre scripts are executed, Monoweave publishes the package archive to the specified registry. Post scripts will then run, regardless of whether the publish was successful or not.</p>
<p>You can think of the publish process as being split into distinct stages wherein each stage will execute exactly one type of lifecycle script, while respecting topological sort options while executing that stage. For example, when calling &quot;prepublish&quot;, Monoweave will trigger prepublish in topological order (if the topological config option is set) and will <em>not</em> execute the prepack script until <em>all</em> prepublish scripts have completed.</p>
<p>The exact order of lifecycle scripts executed is as follows (this may differ from NPM, Yarn, and Lerna):</p>
<ol>
<li>prepublish<!-- -->
<ul>
<li>This is called before packing even starts. Since NPM will execute this lifecycle script on installs, NPM deprecated this lifecycle script in favour of &#x27;prepublishOnly&#x27;. That being said, Yarn Modern <em>does not</em> call prepublishOnly but calls &#x27;prepublish&#x27;. Further, Yarn does not call prepublish on install.</li>
</ul>
</li>
<li>prepare<!-- -->
<ul>
<li>This is not called by Yarn, however it is called by NPM and by Lerna prior to packing. It is <em>not recommended</em> to leverage this lifecycle hook for compilation.</li>
</ul>
</li>
<li>prepublishOnly<!-- -->
<ul>
<li>This is not directly supported by Yarn Modern, however was introduced by NPM as a replacement for the deprecated &#x27;prepublish&#x27; script.</li>
</ul>
</li>
<li>prepack<!-- -->
<ul>
<li>This is the lifecycle hook that you should be using for any compilation, such as compiling TypeScript to JavaScript. Errors thrown here, or in any early pre lifecycle script, will abort the publish process.</li>
</ul>
</li>
<li>
<delete>publish</delete>
<ul>
<li>At this &quot;stage&quot; we pack and publish each package. We do not call any &#x27;publish&#x27; lifecycle scripts here.</li>
</ul>
</li>
<li>postpack<!-- -->
<ul>
<li>This is guaranteed to execute after packing the archive, regardless of failure. This is useful script for build directory cleanup.</li>
</ul>
</li>
<li>postpublish<!-- -->
<ul>
<li>This is guaranteed to execute after postpack and is the final lifecycle script called in the publish pipeline. Note that Monoweave will still do work following this lifecycle script, mainly around changelog generation, and git management.</li>
</ul>
</li>
</ol></main><hr/><footer style="margin-top:2rem"><a href="https://noahnu.com/" rel="noreferrer" target="_blank">noahnu</a> <!-- -->© <!-- -->2025</footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/architecture/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-46be901d106013f4d17a.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-1bbffd025530da31451a.js\"],\"component---src-pages-architecture-mdx\":[\"/component---src-pages-architecture-mdx-210560166c882c281919.js\"],\"component---src-pages-configuration-mdx\":[\"/component---src-pages-configuration-mdx-a6c742377ca261f9fe1f.js\"],\"component---src-pages-contributing-mdx\":[\"/component---src-pages-contributing-mdx-00db521128a0c5453fda.js\"],\"component---src-pages-faq-mdx\":[\"/component---src-pages-faq-mdx-3daab951ae21d5229669.js\"],\"component---src-pages-getting-started-mdx\":[\"/component---src-pages-getting-started-mdx-72dc70cfac8ea219376a.js\"],\"component---src-pages-index-mdx\":[\"/component---src-pages-index-mdx-8b079f8c0775deb660d1.js\"],\"component---src-pages-plugins-mdx\":[\"/component---src-pages-plugins-mdx-faa6c6df93b2e8fa5b91.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="12f5218fd53ec51b8014";</script><script src="https://monoweave.github.io/monoweave/webpack-runtime-e6a4f12711d45b362e8c.js" async></script><script src="https://monoweave.github.io/monoweave/framework-d49e96009df721921ad5.js" async></script><script src="https://monoweave.github.io/monoweave/app-46be901d106013f4d17a.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>